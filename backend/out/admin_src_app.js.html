<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: admin/src/app.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: admin/src/app.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const cluster = require("cluster");
const express = require("express");
const mongoose = require("mongoose");
const { join } = require("path");
const logger = require("./tools/logger");
const cors = require("cors");
let ddos = new Ddos({burst: 10, limit: 15});


/** The Server class is responsible for initializing the Express framework, the Mongoose and MongoDB drivers,
 * all the middlewares and all of the controllers as well.
 *
 * The MVC/MC pattern allows a pretty decent scalability of controllers with zero code on this class and a one liner
 * on the applications entry file (index.js). Also unifies MongoDB connections, making the use of models really quick
 * by discarding the necessity to establish a new connection at every import of each model.
 *
 * Also responsible for shutting the service down if anything goes wrong.
 */

module.exports = class Server {
	/**
	 * Instantiates express callbacks, database, middlewares and controllers.
	 * @param controllers
	 */
	constructor(controllers) {
		this.app = express();
		this.DB();
		this.initMiddlewares();
		this.initControllers(controllers);
	}
	/**
	 * Listens in the desired port.
	 *
	 * @method
	 * @listens {Request} Express http request.
	 */

	listen() {
		this.app.listen(process.env.PORT || 5001, () =>
			logger.info(`Admin service has been started!`)
		);
	}

	/**
	 * Initializes middlewares: cors and body parser.
	 * @method
	 */

	initMiddlewares() {
        this.app.use(ddos.express);
		this.app.use(cors());
		this.app.use(express.json());
		this.app.use(express.urlencoded({ extended: true }));
	}

	/**
	 * Loop through and initializes all controllers of the application.
	 * @method
	 */

	initControllers(controllers) {
		for (let controller of controllers) {
			this.app.use("/", controller.router);
		}
	}

	/**
	 * Standard initialization and connSection of MongoDB with Mongoose and events listener for exceptions and messages.
	 * @method
	 * @listens {&lt;http>MongoDB} http MongoDB object events
	 */

	DB() {
		try {
			this.connection = mongoose.connect(process.env.MONGO_ACCESS, {
				useNewUrlParser: true,
				useCreateIndex: true,
				useUnifiedTopology: true
			});
			if (this.connection) logger.info("MongoDB is up and running...");
		} catch (e) {
			logger.error(`MongoDB ERROR: ${e}`);
			process.exit(1);
		}

		mongoose.connection.on("connected", () => {
			logger.info(`Mongoose connection event received!`);
		});

		mongoose.connection.on("error", err => {
			logger.error("Mongoose default connection error: " + err);
		});

		mongoose.connection.on("disconnected", () => {
			logger.info("Mongoose default connection disconnected");
		});

		process.on("SIGINT", () => {
			mongoose.connection.close(function () {
				logger.info(
					"Mongoose default connection disconnected through app termination"
				);
				process.exit(0);
			});
		});
	}
};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-winston.html">winston</a></li></ul><h3>Classes</h3><ul><li><a href="module.exports.html">exports</a></li><li><a href="Rank.html">Rank</a></li><li><a href="SongMapper.html">SongMapper</a></li><li><a href="Top.html">Top</a></li></ul><h3>Global</h3><ul><li><a href="global.html#User">User</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.3</a> on Mon Dec 16 2019 00:50:20 GMT-0300 (GMT-03:00)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
